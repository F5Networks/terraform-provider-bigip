<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Scenario #2: Managing with Terraform an existing WAF policy</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Scenario #2: Managing with Terraform an existing WAF policy"/>
  <meta name="product" content="F5 BIG-IP Resources for Terraform"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2023-04-26 11:52:19"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 BIG-IP Resources for Terraform" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Scenario #2: Managing with Terraform an existing WAF policy &#8212; F5 Modules for Terraform</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/table_styling.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scenario #3: Migrating a WAF Policy from one BIG-IP to another BIG-IP" href="awaf-migrate.html" />
    <link rel="prev" title="Scenario #1: Creating a WAF Policy" href="awaf-create.html" />

  
    

  
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 BIG-IP Resources for Terraform  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">F5 Terraform Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">F5 Terraform Resources Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing.html">Installing Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuring.html">Configuring Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
</ul>
<p class="caption"><span class="caption-text">F5 BIG-IP Provider</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index-bigip.html">F5 BIG-IP Provider Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index-bigip.html#releases-and-versioning">Releases and Versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">F5 BIG-IP Provider Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bigip-modules/index.html">F5 BIG-IP Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../as3-integration.html">AS3 Integration with Terraform</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced WAF Integration with Terraform</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-usage">Example Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#integration-resources-and-data-sources">Integration Resources and Data Sources</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#quickstart-and-lab-guides">Quickstart and Lab Guides</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fast-integration/index.html">FAST Integration with Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../do-integration.html">Declarative Onboarding Integration with Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bigiq-licensing.html">Licensing BIG-IP with BIG-IQ</a></li>
</ul>
<p class="caption"><span class="caption-text">F5OS Provider</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../F5OS/index-f5os.html">F5OS Resources for Terraform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../F5OS/release-notes.html">F5OS Provider Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../F5OS/f5os-modules.html">F5OS Tenant Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../F5OS/f5os-qsg.html">F5OS Quick Start Guide</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Scenario #2: Managing with Terraform an existing WAF policy</a><ul>
<li><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="reference internal" href="#policy-import">Policy Import</a></li>
<li><a class="reference internal" href="#policy-lifecycle-management">Policy lifecycle management</a><ul>
<li><a class="reference internal" href="#defining-parameters">Defining parameters</a></li>
<li><a class="reference internal" href="#defining-urls">Defining URLs</a></li>
<li><a class="reference internal" href="#defining-attack-signatures">Defining Attack Signatures</a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">CloudDocs Home</a> &gt; <a href="../../index.html">F5 BIG-IP Resources for Terraform </a> &gt; Scenario #2: Managing with Terraform an existing WAF policy</li>
          </ul>
      </nav>
      
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="scenario-2-managing-with-terraform-an-existing-waf-policy">
<span id="awaf-import"></span><h1>Scenario #2: Managing with Terraform an existing WAF policy<a class="headerlink" href="#scenario-2-managing-with-terraform-an-existing-waf-policy" title="Permalink to this headline">¶</a></h1>
<p>The goal of this lab is to take an existing F5 BIG-IP Advanced WAF Policy – that has been created and managed on an F5 BIG-IP outside of Terraform – and to import and manage its lifecycle using the F5 BIG-IP Terraform Provider.</p>
<p>You may already have multiple WAF policies protecting your applications and these WAF policies have evolved over the past months or years. It may be very complicated to do an extensive inventory of each policy, each entity, and every attribute. The goal here is to import the current policy, which will be your current baseline. Every new change, addition of a Server Technology, parameter, or attack signature will be done through Terraform in addition or correction of this new baseline.</p>
<div class="section" id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<p>On the BIG-IP:</p>
<ul class="simple">
<li>Version 16.1 or newer</li>
<li>Credentials with REST API access</li>
<li>/Common/scenario2 WAF policy (Rapid deployment template) created</li>
</ul>
<p>On Terraform:</p>
<ul class="simple">
<li>Using F5 BIG-IP provider version 1.15.0 or newer</li>
<li>Using Hashicorp versions following <a class="reference internal" href="../index-bigip.html#versions"><span class="std std-ref">Releases and Versioning</span></a></li>
</ul>
</div>
<div class="section" id="policy-import">
<h2>Policy Import<a class="headerlink" href="#policy-import" title="Permalink to this headline">¶</a></h2>
<p>Create 3 files:</p>
<ul class="simple">
<li>variables.tf</li>
<li>inputs.tfvars</li>
<li>main.tf</li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">variables.tf</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>variable bigip {}
variable username {}
variable password {}
</pre></div>
</td></tr></table></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">inputs.tfvars</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>bigip = &quot;10.1.1.9:443&quot;
username = &quot;admin&quot;
password = &quot;whatIsYourBigIPPassword?&quot;
</pre></div>
</td></tr></table></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">main.tf</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>terraform {
  required_providers {
    bigip = {
      source = &quot;F5Networks/bigip&quot;
      version = &quot;1.15&quot;
    }
  }
}
provider &quot;bigip&quot; {
  address  = var.bigip
  username = var.username
  password = var.password
}

resource &quot;bigip_waf_policy&quot; &quot;this&quot; {
  partition            = &quot;Common&quot;
  name                 = &quot;scenario2&quot;
  template_name        = &quot;POLICY_TEMPLATE_RAPID_DEPLOYMENT&quot;
}
</pre></div>
</td></tr></table></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">outputs.tf</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span>output &quot;policyId&quot; {
     value   = bigip_waf_policy.this.policy_id
}


output &quot;policyJSON&quot; {
        value   = bigip_waf_policy.this.policy_export_json
}
</pre></div>
</td></tr></table></div>
</div>
<p>As you can see, we only define the two required attributes of the “bigip_waf_policy” terraform resource: name and template_name. It is required to provide them in order to be able to manage the resource.</p>
<p>Now you need the Policy ID. There are multiple ways to get it:</p>
<ul class="simple">
<li>Check on the iControl REST API Endpoint: <code class="docutils literal notranslate"><span class="pre">/mgmt/tm/asm/policies?$filter=name+eq+scenario2&amp;$select=id</span></code></li>
<li>Get a script example in the <code class="docutils literal notranslate"><span class="pre">lab/scripts/</span></code> folder</li>
<li>Use a Go code</li>
</ul>
<p>In this example we are using the Online Go Playground as it is easy and quick to use:</p>
<ol class="arabic">
<li><p class="first">Copy the following piece of code in the <a class="reference external" href="https://go.dev/play/">Go PlayGround</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// You can edit this code!
// Click here and start typing.
package main

import &quot;fmt&quot;

func main() {
  fmt.Println(&quot;Hello, 世界&quot;)
}
</pre></div>
</div>
</li>
<li><p class="first">Update the value of the following variables located in the main function:</p>
<p><code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">partition</span> <span class="pre">string</span> <span class="pre">=</span> <span class="pre">&quot;Common&quot;</span></code> <br />
<code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">policyName</span> <span class="pre">string</span> <span class="pre">=</span> <span class="pre">&quot;scenario2&quot;</span></code></p>
</li>
<li><p class="first">Run and get the policy ID.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;crypto/md5&quot;</span>
    <span class="n">b64</span> <span class="s2">&quot;encoding/base64&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">Hasher</span><span class="p">(</span><span class="n">policyName</span> <span class="n">string</span><span class="p">)</span> <span class="n">string</span> <span class="p">{</span>
    <span class="n">hasher</span> <span class="p">:</span><span class="o">=</span> <span class="n">md5</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>
    <span class="n">hasher</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">policyName</span><span class="p">))</span>
    <span class="n">encodedString</span> <span class="p">:</span><span class="o">=</span> <span class="n">b64</span><span class="o">.</span><span class="n">StdEncoding</span><span class="o">.</span><span class="n">EncodeToString</span><span class="p">(</span><span class="n">hasher</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">nil</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">strings</span><span class="o">.</span><span class="n">TrimRight</span><span class="p">(</span><span class="n">encodedString</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">partition</span> <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Common&quot;</span>
    <span class="n">var</span> <span class="n">policyName</span> <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;scenario2&quot;</span>

    <span class="n">fullName</span> <span class="p">:</span><span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">partition</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">policyName</span>
    <span class="n">policyId</span> <span class="p">:</span><span class="o">=</span> <span class="n">Hasher</span><span class="p">(</span><span class="n">fullName</span><span class="p">)</span>

    <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="n">strings</span><span class="o">.</span><span class="n">NewReplacer</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Policy Id: &quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="n">policyId</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Run the following commands to:</p>
<ol class="arabic simple">
<li>Initialize the Terraform Project.</li>
<li>Import the current WAF policy into your state.</li>
<li>Set the JSON WAF Policy as your new baseline.</li>
<li>Configure the lifecycle of your WAF Policy.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform init
Initializing the backend...

Initializing provider plugins...
[...]

Terraform has been successfully initialized!

foo@bar:~$ terraform import bigip_waf_policy.this EdchwjSqo9cFtYP-iWUJmw
bigip_waf_policy.this: Importing from ID &quot;EdchwjSqo9cFtYP-iWUJmw&quot;...
bigip_waf_policy.this: Import prepared!
  Prepared bigip_waf_policy for import
bigip_waf_policy.this: Refreshing state... [id=EdchwjSqo9cFtYP-iWUJmw]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Update your Terraform <strong>main.tf</strong> file with the ouputs of the following two commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform show -json | jq &#39;.values.root_module.resources[].values.policy_export_json | fromjson&#39; &gt; importedWAFPolicy.json

foo@bar:~$ terraform show -no-color
# bigip_waf_policy.this:
resource &quot;bigip_waf_policy&quot; &quot;this&quot; {
    application_language = &quot;utf-8&quot;
    id                   = &quot;EdchwjSqo9cFtYP-iWUJmw&quot;
    name                 = &quot;scenario2&quot;
    partition            = &quot;Common&quot;
    policy_export_json   = jsonencode(
        {
            [...]
        }
    )
    policy_id            = &quot;EdchwjSqo9cFtYP-iWUJmw&quot;
    template_name        = &quot;POLICY_TEMPLATE_FUNDAMENTAL&quot;
    type                 = &quot;security&quot;
}
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Using the collected data from the Terraform import, you can now update your <strong>main.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;bigip_waf_policy&quot;</span> <span class="s2">&quot;this&quot;</span> <span class="p">{</span>
    <span class="n">application_language</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>
    <span class="n">name</span>                 <span class="o">=</span> <span class="s2">&quot;scenario2&quot;</span>
    <span class="n">partition</span>            <span class="o">=</span> <span class="s2">&quot;Common&quot;</span>
    <span class="n">policy_id</span>            <span class="o">=</span> <span class="s2">&quot;EdchwjSqo9cFtYP-iWUJmw&quot;</span>
    <span class="n">template_name</span>        <span class="o">=</span> <span class="s2">&quot;POLICY_TEMPLATE_FUNDAMENTAL&quot;</span>
    <span class="nb">type</span>                 <span class="o">=</span> <span class="s2">&quot;security&quot;</span>
    <span class="n">policy_import_json</span>   <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">{path.module}</span><span class="s2">/importedWAFPolicy.json&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Note that we replaced the “policy_export_json” argument with “policy_import_json” pointing to the imported WAF Policy JSON file.</p>
<p>Finally, you can plan and apply your new project.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform plan -out scenario2
bigip_waf_policy.this: Refreshing state... [id=EdchwjSqo9cFtYP-iWUJmw]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  ~ update in-place
[...]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

Saved the plan to: scenario2

To perform exactly these actions, run the following command to apply:
    terraform apply &quot;scenario2&quot;

foo@bar:~$ terraform apply &quot;scenario2&quot;
bigip_waf_policy.this: Modifying... [id=EdchwjSqo9cFtYP-iWUJmw]
bigip_waf_policy.this: Still modifying... [id=EdchwjSqo9cFtYP-iWUJmw, 10s elapsed]
bigip_waf_policy.this: Modifications complete after 16s [id=EdchwjSqo9cFtYP-iWUJmw]

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

policyId = &quot;EdchwjSqo9cFtYP-iWUJmw&quot;
policyJSON = &quot;{[...]}&quot;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="policy-lifecycle-management">
<h2>Policy lifecycle management<a class="headerlink" href="#policy-lifecycle-management" title="Permalink to this headline">¶</a></h2>
<p>Now you can manage your WAF Policy as we did in <a class="reference internal" href="awaf-create.html#awaf-create"><span class="std std-ref">Scenario #1: Creating a WAF Policy</span></a>.</p>
<p>You can check your WAF Policy on your BIG-IP after each Terraform apply.</p>
<div class="section" id="defining-parameters">
<h3>Defining parameters<a class="headerlink" href="#defining-parameters" title="Permalink to this headline">¶</a></h3>
<p>Create a <strong>parameters.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="s2">&quot;bigip_waf_entity_parameter&quot;</span> <span class="s2">&quot;P1&quot;</span> <span class="p">{</span>
  <span class="n">name</span>            <span class="o">=</span> <span class="s2">&quot;Parameter1&quot;</span>
  <span class="nb">type</span>            <span class="o">=</span> <span class="s2">&quot;explicit&quot;</span>
  <span class="n">data_type</span>       <span class="o">=</span> <span class="s2">&quot;alpha-numeric&quot;</span>
  <span class="n">perform_staging</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">signature_overrides_disable</span> <span class="o">=</span> <span class="p">[</span><span class="mi">200001494</span><span class="p">,</span> <span class="mi">200001472</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add references to these parameters in the “bigip_waf_policy” TF resource in the <strong>main.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;bigip_waf_policy&quot;</span> <span class="s2">&quot;this&quot;</span> <span class="p">{</span>
  <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">parameters</span>           <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">bigip_waf_entity_parameter</span><span class="o">.</span><span class="n">P1</span><span class="o">.</span><span class="n">json</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform plan -out scenario2
foo@bar:~$ terraform apply &quot;scenario2&quot;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="defining-urls">
<h3>Defining URLs<a class="headerlink" href="#defining-urls" title="Permalink to this headline">¶</a></h3>
<p>Create a <strong>urls.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="s2">&quot;bigip_waf_entity_url&quot;</span> <span class="s2">&quot;U1&quot;</span> <span class="p">{</span>
  <span class="n">name</span>                             <span class="o">=</span> <span class="s2">&quot;/URL1&quot;</span>
  <span class="n">description</span>                 <span class="o">=</span> <span class="s2">&quot;this is a test for URL1&quot;</span>
  <span class="nb">type</span>                        <span class="o">=</span> <span class="s2">&quot;explicit&quot;</span>
  <span class="n">protocol</span>                    <span class="o">=</span> <span class="s2">&quot;http&quot;</span>
  <span class="n">perform_staging</span>             <span class="o">=</span> <span class="n">true</span>
  <span class="n">signature_overrides_disable</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12345678</span><span class="p">,</span> <span class="mi">87654321</span><span class="p">]</span>
  <span class="n">method_overrides</span> <span class="p">{</span>
    <span class="n">allow</span>  <span class="o">=</span> <span class="n">false</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;BCOPY&quot;</span>
  <span class="p">}</span>
  <span class="n">method_overrides</span> <span class="p">{</span>
    <span class="n">allow</span>  <span class="o">=</span> <span class="n">true</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;BDELETE&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data</span> <span class="s2">&quot;bigip_waf_entity_url&quot;</span> <span class="s2">&quot;U2&quot;</span> <span class="p">{</span>
  <span class="n">name</span>                        <span class="o">=</span> <span class="s2">&quot;/URL2&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add references to this URL in the “bigip_waf_policy” TF resource in the <strong>main.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;bigip_waf_policy&quot;</span> <span class="s2">&quot;this&quot;</span> <span class="p">{</span>
  <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">urls</span>                 <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">bigip_waf_entity_url</span><span class="o">.</span><span class="n">U1</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">bigip_waf_entity_url</span><span class="o">.</span><span class="n">U2</span><span class="o">.</span><span class="n">json</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Run it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform plan -out scenario2
foo@bar:~$ terraform apply &quot;scenario2&quot;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="defining-attack-signatures">
<h3>Defining Attack Signatures<a class="headerlink" href="#defining-attack-signatures" title="Permalink to this headline">¶</a></h3>
<p>Create a <strong>signatures.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="s2">&quot;bigip_waf_signatures&quot;</span> <span class="s2">&quot;S1&quot;</span> <span class="p">{</span>
  <span class="n">signature_id</span>     <span class="o">=</span> <span class="mi">200104004</span>
  <span class="n">description</span>      <span class="o">=</span> <span class="s2">&quot;Java Code Execution&quot;</span>
  <span class="n">enabled</span>          <span class="o">=</span> <span class="n">true</span>
  <span class="n">perform_staging</span>  <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">data</span> <span class="s2">&quot;bigip_waf_signatures&quot;</span> <span class="s2">&quot;S2&quot;</span> <span class="p">{</span>
  <span class="n">signature_id</span>     <span class="o">=</span> <span class="mi">200104005</span>
  <span class="n">enabled</span>          <span class="o">=</span> <span class="n">false</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Add references to this URL in the “bigip_waf_policy” TF resource in the <strong>main.tf</strong> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;bigip_waf_policy&quot;</span> <span class="s2">&quot;this&quot;</span> <span class="p">{</span>
  <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">signatures</span>       <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">bigip_waf_signatures</span><span class="o">.</span><span class="n">S1</span><span class="o">.</span><span class="n">json</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">bigip_waf_signatures</span><span class="o">.</span><span class="n">S2</span><span class="o">.</span><span class="n">json</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Run it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo@bar:~$ terraform plan -out scenario2
foo@bar:~$ terraform apply &quot;scenario2&quot;
</pre></div>
</div>
<p>What’s Next?</p>
<ul class="simple">
<li><a class="reference internal" href="awaf-create.html#awaf-create"><span class="std std-ref">Create a WAF policy</span></a></li>
<li><a class="reference internal" href="awaf-migrate.html#awaf-migrate"><span class="std std-ref">Migrate WAF policy from one BIG-IP to another</span></a></li>
<li><a class="reference internal" href="awaf-multiple.html#awaf-multiple"><span class="std std-ref">Manage WAF policies for multiple devices</span></a></li>
<li><a class="reference internal" href="awaf-policybuildersingle.html#awaf-policybuildersingle"><span class="std std-ref">Using WAF policy builder to manage a single device</span></a></li>
<li><a class="reference internal" href="awaf-policybuildermultiple.html#awaf-policybuildermultiple"><span class="std std-ref">Using WAF policy builder to manage multiple devices</span></a></li>
<li><a class="reference internal" href="../release-notes.html#release-notes"><span class="std std-ref">Release Notes</span></a></li>
</ul>
</div>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="awaf-create.html" title="Scenario #1: Creating a WAF Policy" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="awaf-migrate.html" title="Scenario #3: Migrating a WAF Policy from one BIG-IP to another BIG-IP" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  </body>
</html>